import time
import serial
import json
import sys
from flask import Flask,request
from flask_cors import CORS

app = Flask(__name__)
app.config['CORS_HEADERS'] = 'Content-Type'

cors = CORS(app,resources={r"/terrible": {"origins": "https://ms.cpolar.cn"}})   # Please modify it yourself

ser = serial.Serial(
        port='/dev/serial0',
        baudrate=115200,
        parity=serial.PARITY_NONE,
        stopbits=serial.STOPBITS_ONE,
        bytesize=serial.EIGHTBITS,
        timeout=1
        )

class Controllers:

    # skyworth BQ-TTL-IRTM
    def __init__(self):
        self.skyworth_dict = {
                "power":
                [0xFE, 0xFD, 0x02, 0x57, 0xC2, 0x3D, 0x69, 0x3D, 0x6A, 0x3C, 0x33, 0x3C, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x33, 0x3C, 0x69, 0x3D, 0x33, 0x3F, 0x67, 0x3C, 0x6A, 0x3F, 0x30, 0x3C, 0x6A, 0x3D, 0x32, 0x3D, 0x33, 0x3C, 0x33, 0x3C, 0x6A, 0x3D, 0x69, 0x3C, 0x33, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x33, 0x01, 0x6E, 0x01, 0x67, 0x3C, 0x32, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3F, 0x67, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x33, 0x3F, 0x67, 0x3C, 0x6A, 0x3C, 0x33, 0x3C, 0x6A, 0x3C, 0xFF],
                "mute":
                [0xFE, 0xFD, 0x02, 0x58, 0xC2, 0x3C, 0x6A, 0x3F, 0x67, 0x3F, 0x31, 0x3E, 0x31, 0x3D, 0x69, 0x3C, 0x34, 0x3E, 0x67, 0x3D, 0x33, 0x3C, 0x33, 0x3D, 0x69, 0x3F, 0x31, 0x3C, 0x6A, 0x3C, 0x6A, 0x3D, 0x33, 0x3C, 0x69, 0x3D, 0x33, 0x3F, 0x67, 0x3D, 0x32, 0x3F, 0x67, 0x40, 0x66, 0x3D, 0x33, 0x3C, 0x33, 0x3D, 0x69, 0x40, 0x30, 0x01, 0x71, 0x01, 0x64, 0x3D, 0x32, 0x3D, 0x33, 0x3C, 0x6A, 0x3F, 0x31, 0x3E, 0x67, 0x3F, 0x31, 0x3F, 0x67, 0x3F, 0x33, 0x3A, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3F, 0x31, 0x3E, 0x68, 0x3E, 0x6A, 0x3A, 0x33, 0x3F, 0x67, 0x3D, 0xFF],
                "retreat":
                [0xFE, 0xFD, 0x02, 0x58, 0xC1, 0x3D, 0x69, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3C, 0x6A, 0x3D, 0x32, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x32, 0x3D, 0x33, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x33, 0x01, 0x6E, 0x01, 0x67, 0x3C, 0x32, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x6A, 0x3C, 0x6A, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0xFF],
                "vol-up":
                [0xFE, 0xFD, 0x02, 0x58, 0xC2, 0x3D, 0x69, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x6A, 0x3C, 0x33, 0x3C, 0x6A, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x6A, 0x3C, 0x33, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x6A, 0x3C, 0x33, 0x01, 0x6F, 0x01, 0x66, 0x3D, 0x32, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x6A, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x6A, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x69, 0x40, 0xFF],
                "vol-down":
                [0xFE, 0xFD, 0x02, 0x58, 0xC2, 0x3C, 0x6A, 0x3C, 0x6A, 0x3F, 0x30, 0x3F, 0x30, 0x3D, 0x6A, 0x3C, 0x33, 0x3C, 0x6A, 0x3F, 0x30, 0x3F, 0x30, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x69, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x33, 0x01, 0x6E, 0x01, 0x67, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x6A, 0x3C, 0x33, 0x3F, 0x66, 0x3D, 0x32, 0x40, 0x67, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x69, 0x3F, 0x30, 0x3D, 0x6A, 0x3F, 0x67, 0x3F, 0x30, 0x3D, 0x69, 0x3D, 0xFF],
                "confirmation":
                [0xFE, 0xFD, 0x02, 0x58, 0xC2, 0x3D, 0x69, 0x3C, 0x6A, 0x3D, 0x32, 0x3D, 0x32, 0x3D, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x33, 0x3C, 0x6A, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x32, 0x3D, 0x6A, 0x3C, 0x33, 0x01, 0x6F, 0x01, 0x66, 0x3D, 0x32, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x33, 0x3F, 0x67, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x6A, 0x3D, 0x69, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x6A, 0x3C, 0xFF],
                "up":
                [0xFE, 0xFD, 0x02, 0x58, 0xC2, 0x3D, 0x69, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x33, 0x3F, 0x67, 0x3D, 0x32, 0x3D, 0x6A, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x33, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x33, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x33, 0x01, 0x6E, 0x01, 0x67, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x6A, 0x3C, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x69, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x6A, 0x3D, 0x69, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0xFF],
                "down":
                [0xFE, 0xFD, 0x02, 0x58, 0xC2, 0x3D, 0x6A, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x6A, 0x3F, 0x30, 0x3C, 0x6A, 0x3D, 0x32, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x6A, 0x3D, 0x33, 0x3C, 0x69, 0x3D, 0x33, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x32, 0x3D, 0x33, 0x3F, 0x67, 0x3F, 0x31, 0x01, 0x6E, 0x01, 0x67, 0x3C, 0x33, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x6A, 0x3C, 0x33, 0x3F, 0x67, 0x3D, 0x69, 0x3D, 0x6A, 0x3E, 0x31, 0x3C, 0x6A, 0x3F, 0xFF],
                "left":
                [0xFE, 0xFD, 0x02, 0x58, 0xC1, 0x3D, 0x69, 0x3D, 0x6A, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x69, 0x40, 0x30, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x6A, 0x3C, 0x33, 0x3F, 0x67, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x6A, 0x3E, 0x31, 0x3C, 0x33, 0x3C, 0x6A, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x33, 0x3F, 0x30, 0x3C, 0x6A, 0x3F, 0x30, 0x01, 0x6F, 0x01, 0x66, 0x3D, 0x33, 0x3C, 0x33, 0x3C, 0x6A, 0x3F, 0x30, 0x3F, 0x67, 0x3F, 0x31, 0x3C, 0x6A, 0x3F, 0x30, 0x3D, 0x69, 0x3F, 0x30, 0x3D, 0x33, 0x3E, 0x68, 0x3C, 0x6A, 0x3C, 0x6A, 0x3F, 0x31, 0x3E, 0x67, 0x3D, 0xFF],
                "right":
                [0xFE, 0xFD, 0x02, 0x58, 0xC1, 0x3D, 0x6A, 0x3C, 0x6A, 0x3C, 0x33, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x69, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x6A, 0x3C, 0x6A, 0x3D, 0x32, 0x3D, 0x33, 0x3C, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x01, 0x6E, 0x01, 0x67, 0x3F, 0x31, 0x3C, 0x32, 0x3D, 0x69, 0x3D, 0x33, 0x3F, 0x66, 0x3D, 0x33, 0x3C, 0x6A, 0x3D, 0x32, 0x3D, 0x32, 0x3D, 0x33, 0x3F, 0x30, 0x3C, 0x6A, 0x3D, 0x69, 0x3D, 0x69, 0x3F, 0x31, 0x3E, 0x68, 0x3C, 0xFF],
                "menu":
                [0xFE, 0xFD, 0x02, 0x58, 0xC2, 0x3C, 0x6A, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x69, 0x3D, 0x33, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x32, 0x3D, 0x32, 0x3D, 0x33, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x32, 0x01, 0x6F, 0x01, 0x66, 0x3D, 0x33, 0x3C, 0x33, 0x3C, 0x6A, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0x32, 0x3D, 0x69, 0x3D, 0x33, 0x3C, 0x33, 0x3C, 0x6A, 0x3D, 0x69, 0x3F, 0x67, 0x3F, 0x67, 0x3D, 0x69, 0x3C, 0x33, 0x3D, 0x69, 0x3D, 0xFF]
                }

@app.route('/terrible',methods=['POST'])
def variable():
    ir = Controllers()
    key_string = str(request.data.decode("utf-8"))
    k_string = key_string.strip('"')
    try:
        kk = ser.write(serial.to_bytes(ir.skyworth_dict[k_string]))
        print(kk)
    except Exception as e:
        print(e)
        pass
    print(k_string)
    return key_string


if __name__ == "__main__":

    app.run(host='0.0.0.0',port=3344,debug=True)
